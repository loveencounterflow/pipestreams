{
  "version": 3,
  "file": "wye-tee-merge.js",
  "sourceRoot": "..",
  "sources": [
    "src/wye-tee-merge.coffee"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "\n'use strict'\n\n############################################################################################################\nCND                       = require 'cnd'\nrpr                       = CND.rpr\nbadge                     = 'PIPESTREAMS/WYE-TEE-MERGE'\n# log                       = CND.get_logger 'plain',     badge\n# info                      = CND.get_logger 'info',      badge\n# whisper                   = CND.get_logger 'whisper',   badge\n# alert                     = CND.get_logger 'alert',     badge\ndebug                     = CND.get_logger 'debug',     badge\n# warn                      = CND.get_logger 'warn',      badge\n# help                      = CND.get_logger 'help',      badge\n# urge                      = CND.get_logger 'urge',      badge\n# echo                      = CND.echo.bind CND\n{ jr }                    = CND\nmux                       = require 'pull-mux' ### https://github.com/nichoth/pull-mux ###\n\n\n#-----------------------------------------------------------------------------------------------------------\n@$tee = ( stream ) ->\n  ### **NB** that in contradistinction to `pull-tee`, you can only divert to a single by-stream with each\n  call to `PS.$tee` ###\n  # R = if ( CND.isa_list stream_or_pipeline ) then ( pull stream_or_pipeline ) else stream_or_pipeline\n  return ( require 'pull-tee' ) stream\n\n#-----------------------------------------------------------------------------------------------------------\n@$merge = ( sources... ) ->\n  #.........................................................................................................\n  $_mux = ( sources... ) =>\n    R = {}\n    R[ idx ] = source for source, idx in sources\n    return mux R\n  #.........................................................................................................\n  $_demux = => @$map ( [ k, v, ] ) -> v\n  #.........................................................................................................\n  pipeline  = []\n  pipeline.push $_mux sources...\n  pipeline.push $_demux()\n  return @pull pipeline...\n\n#-----------------------------------------------------------------------------------------------------------\n@$wye = ( bysource ) ->\n  mainstream_ended  = false\n  bystream_started  = false\n  bystream_ended    = false\n  send              = null\n  done              = null\n  buffer            = []\n  stack             = ( x ) => buffer.unshift x\n  flush             = => send buffer.pop() while buffer.length > 0\n  #.........................................................................................................\n  bystream          = []\n  bystream.push bysource\n  bystream.push @$watch ( d ) => debug '77100-1', jr d\n  bystream.push @$ 'null', ( d, _send ) =>\n    if d?\n      ### When `done` is defined, mainstream has ended, but `done` has not been called, meaning we can\n      send directly (but avoid calling `done` yet); otherwise, we buffer the data: ###\n      debug '77100-2', done?, jr d\n      if done?\n        debug '77100-3', done?, jr d\n        send  d\n      else\n        debug '77100-4', done?, jr d\n        stack d\n    else\n      ### When data is `null`, bystream has ended; if mainstream has already ended, `done` is be defined,\n      so we flush out any remaining data, then call `done`: ###\n      bystream_ended = true\n      if done?\n        debug '77100-5', jr d\n        flush()\n        done()\n    return null\n  bystream.push @$watch ( d ) => debug '77100-6', jr d\n  bystream.push @$drain()\n  #.........................................................................................................\n  mainstream        = []\n  mainstream.push @$async 'null', ( d, _send, _done ) =>\n    ### `send` and `done` are shared within this method and will be needed to send values from bystream\n    if it terminates later than mainstream: ###\n    send = _send\n    done = _done\n    #.......................................................................................................\n    unless bystream_started\n      ### In case bystream has not yeen been started, do that now: ###\n      debug '77100-7', \"bystream started\", jr d\n      bystream_started = true\n      @pull bystream...\n    #.......................................................................................................\n    if d?\n      debug '77100-8', jr d\n      ### In case there's mainstream data, flush out any bystream data, send d, call `done` and\n      un-define it: ###\n      flush()\n      send d\n      done()\n      done = null\n    else\n      debug '77100-9', bystream_ended, buffer, jr d #; send 'xxx'\n      ### In case mainstream data is `null`, mainstream has terminated. If bystream has been terminated\n      as well, call `done` and un-define it: ###\n      flush()\n      if bystream_ended\n        send null\n        done()\n        done = null\n    #.......................................................................................................\n    return null\n  #.........................................................................................................\n  R = @pull mainstream...\n  return R\n"
  ]
}