{
  "version": 3,
  "file": "njs-streams-and-files.js",
  "sourceRoot": "..",
  "sources": [
    "src/njs-streams-and-files.coffee"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "\n\n'use strict'\n\n\n############################################################################################################\nCND                       = require 'cnd'\nbadge                     = 'PIPESTREAMS/NJS-STREAMS-AND-FILES'\nFS                        = require 'fs'\nTO_PULL_STREAM            = require 'stream-to-pull-stream'\nTO_NODE_STREAM            = require '../deps/pull-stream-to-stream-patched'\n# TO_NODE_STREAM            = require 'pull-stream-to-stream'\ndefer                     = setImmediate\n\n\n\n#===========================================================================================================\n# READ FROM, WRITE TO FILES, NODEJS STREAMS\n#-----------------------------------------------------------------------------------------------------------\n@read_from_file = ( path, options ) ->\n  ### TAINT consider using https://pull-stream.github.io/#pull-file-reader instead ###\n  switch ( arity = arguments.length )\n    when 1 then null\n    when 2\n      if CND.isa_function options\n        [ path, options, on_stop, ] = [ path, null, options, ]\n    else throw new Error \"µ9983 expected 1 or 2 arguments, got #{arity}\"\n  #.........................................................................................................\n  return @read_from_nodejs_stream ( FS.createReadStream path, options )\n\n#-----------------------------------------------------------------------------------------------------------\n@read_chunks_from_file = ( path, byte_count ) ->\n  unless ( CND.isa_number byte_count ) and ( byte_count > 0 ) and ( byte_count is parseInt byte_count )\n    throw new Error \"expected positive integer number, got #{rpr byte_count}\"\n  pfy           = ( require 'util' ).promisify\n  source        = @new_push_source()\n  #.........................................................................................................\n  defer =>\n    fd    = await ( pfy FS.open ) path, 'r'\n    read  = pfy FS.read\n    loop\n      buffer = Buffer.alloc byte_count\n      await read fd, buffer, 0, byte_count, null\n      source.send buffer\n    return null\n  #.........................................................................................................\n  return source\n\n#-----------------------------------------------------------------------------------------------------------\n@write_to_file = ( path, options, on_stop ) ->\n  ### TAINT consider using https://pull-stream.github.io/#pull-write-file instead ###\n  ### TAINT code duplication ###\n  switch ( arity = arguments.length )\n    when 1 then null\n    when 2\n      if CND.isa_function options\n        [ path, options, on_stop, ] = [ path, null, options, ]\n    when 3\n    else throw new Error \"µ9983 expected 1 to 3 arguments, got #{arity}\"\n  #.........................................................................................................\n  return @write_to_nodejs_stream ( FS.createWriteStream path, options ), on_stop\n\n#-----------------------------------------------------------------------------------------------------------\n@read_from_nodejs_stream = ( stream ) ->\n  switch ( arity = arguments.length )\n    when 1 then null\n    else throw new Error \"µ9983 expected 1 argument, got #{arity}\"\n  #.........................................................................................................\n  return TO_PULL_STREAM.source stream, ( error ) -> finish error\n\n#-----------------------------------------------------------------------------------------------------------\n@write_to_nodejs_stream = ( stream, on_stop ) ->\n  ### TAINT code duplication ###\n  switch ( arity = arguments.length )\n    when 1, 2 then null\n    else throw new Error \"µ9983 expected 1 or 2 arguments, got #{arity}\"\n  #.........................................................................................................\n  if on_stop? and ( ( type = CND.type_of on_stop ) isnt 'function' )\n    throw new Error \"µ9383 expected a function, got a #{type}\"\n  #.........................................................................................................\n  has_finished = false\n  #.........................................................................................................\n  finish = ( error ) ->\n    ### In case there was an error, throw that error if we already called on_stop, or there is no\n    callback given; this is to prevent silent failures: ###\n    if error? and ( has_finished or ( not on_stop? ) )\n      has_finished = true\n      throw error\n    #.......................................................................................................\n    ### Otherwise, call back (with optional error) only in case we have not yet finished; this is to\n    prevent inadvertently calling back more than once: ###\n    if not has_finished\n      has_finished = true\n      if on_stop?\n        return on_stop error if error?\n        return on_stop()\n    #.......................................................................................................\n    return null\n  #.........................................................................................................\n  stream.on 'close', -> finish()\n  return TO_PULL_STREAM.sink stream, ( error ) -> finish error\n\n#-----------------------------------------------------------------------------------------------------------\n@node_stream_from_source = ( source ) -> TO_NODE_STREAM.source source\n@node_stream_from_sink   = ( sink   ) -> TO_NODE_STREAM.sink   sink\n\n\n\n\n\n"
  ]
}